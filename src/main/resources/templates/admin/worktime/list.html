<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script th:src="@{/webjars/vue/2.4.2/dist/vue.min.js}"></script>
	<script th:src="@{/webjars/axios/0.16.1/dist/axios.min.js}"></script>
	<script th:src="@{/webjars/momentjs/2.18.1/min/moment.min.js}"></script>
	<script type="text/javascript" th:src="@{/webjars/jquery/3.2.0/jquery.min.js}"></script>
	<script type="text/javascript" th:src="@{/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js}"></script>
	<link th:href="@{/webjars/font-awesome/4.7.0/css/font-awesome.min.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/webjars/bootstrap/3.3.7-1/css/bootstrap.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/css/common.css}" rel="stylesheet" type="text/css" />

	<title th:text="#{worktime.list.title(${#workTimes.formattedYearMonth(workTimeYearMonth.workYearMonth)})}">2017年07月稼働実績</title>
</head>
<body th:with="yearMonth=${#workTimes.intToYearMonth(workTimeYearMonth.workYearMonth)}, today=${#temporals.createToday()}, thisMonth=${#temporals.month(today)}">
<div th:replace="common/layout::navbar-layout"></div>
<div class="section">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<h1 th:text="#{worktime.list.title(${#workTimes.formattedYearMonth(workTimeYearMonth.workYearMonth)})} +  ' ' + ${workTimeYearMonth.staff.name}">2017年07月稼働実績 山田太郎</h1>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<ul class="breadcrumb">
					<li><a th:href="@{/}" th:text="#{dashboard.title}">ダッシュボード</a></li>
					<li class="active" th:text="#{worktime.list.title(${#workTimes.formattedYearMonth(workTimeYearMonth.workYearMonth)})}">2017年07月稼働実績</li>
				</ul>
			</div>
		</div>
	</div>
	<div th:if="${updatedWorkTimeYearMonth}" class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="alert alert-success" role="alert">
					<span>更新しました。</span>
				</div>
			</div>
		</div>
	</div>
	<!-- TODO:更新メッセージ -->
	<div class="container">
		<div class="row">
			<div class="col-md-12 text-right">
				<!--/*/ <th:block th:unless="${workTimeYearMonth.approved1At}"> /*/-->
				<div class="btn-group">
					<a class="btn btn-default" href="#modal-approve" data-toggle="modal" th:disabled="!${workTimeYearMonth.completedAt}" th:style="!${workTimeYearMonth.completedAt} ? 'pointer-events : none;'">承認</a>
				</div>
				<div class="btn-group">
					<a class="btn btn-default" href="#modal-modify" data-toggle="modal" th:disabled="!${workTimeYearMonth.completedAt}" th:style="!${workTimeYearMonth.completedAt} ? 'pointer-events : none;'">修正</a>
				</div>
				<!--/*/ </th:block> /*/-->
				<p th:with="completedAt=${#temporals.format(workTimeYearMonth.completedAt, 'yyyy/MM/dd hh:mm')}" th:if="${workTimeYearMonth.completedAt}" th:text="#{worktime.completed.message(${workTimeYearMonth.completedBy}, ${completedAt})}">完了:田中太郎(2017/08/10 10:30)</p>
				<p th:with="approvedAt=${#temporals.format(workTimeYearMonth.approved1At, 'yyyy/MM/dd hh:mm')}" th:if="${workTimeYearMonth.approved1At}" th:text="#{worktime.approved.message(${workTimeYearMonth.approved1By}, ${approvedAt})}">承認:田中二郎(2017/08/10 11:10)</p>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<ul class="pager">
					<li th:if="${workTimeYearMonth.completedAt}">
						<a th:href="@{/admin/work-time/{id}?displayYearMonth={displayYearMonth}(id=${workTimeYearMonth.staff.id},displayYearMonth=${yearMonth.minusMonths(1)})}" th:text="'←  ' + ${#temporals.format(yearMonth.minusMonths(1), 'yyyy年MM月')}">←  2017年6月</a>
					</li>
					<li th:unless="${yearMonth.plusMonths(1).getMonthValue() > thisMonth}">
						<a th:href="@{/admin/work-time/{id}?displayYearMonth={displayYearMonth}(id=${workTimeYearMonth.staff.id},displayYearMonth=${yearMonth.plusMonths(1)})}" th:text="${#temporals.format(yearMonth.plusMonths(1), 'yyyy年MM月')} + '  →'">2017年8月  →</a>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="section">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<table class="table table-bordered">
					<thead>
					<tr>
						<th>内容</th>
						<th>日数</th>
					</tr>
					</thead>
					<tbody>
					<tr>
						<th>出勤日数</th>
						<td>
							<span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'NORMAL')}">22</span><span>日</span>
						</td>
					</tr>
					<tr>
						<th>欠勤/半欠勤日数</th>
						<td>
							<span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'ABSENCE')}">22</span><span>/</span><span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'HALF_ABSENCE')}">22</span><span>日</span>
						</td>
					</tr>
					<tr>
						<th>有給/半休取得日数</th>
						<td>
							<span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'FULL_PAID_VACATION')}">22</span><span>/</span><span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'HALF_PAID_VACATION')}">22</span><span>日</span>
						</td>
					</tr>
					<tr>
						<th>事後有給/事後半休取得日数</th>
						<td>
							<span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'FULL_PAID_VACATION_AFTER')}">22</span><span>/</span><span th:text="${#workTimes.workTypeDays(workTimeYearMonth, 'HALF_PAID_VACATION_AFTER')}">22</span><span>日</span>
						</td>
					</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<div class="section">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<table class="table">
					<caption>勤怠表</caption>
					<thead>
					<tr>
						<th class="col-md-1" th:text="#{worktime.list.header.date}">日付</th>
						<th class="col-md-2" th:text="#{worktime.list.header.type}">種別</th>
						<th th:text="#{worktime.list.header.startat}">始業時間</th>
						<th th:text="#{worktime.list.header.endat}">就業時間</th>
						<th class="col-md-1" th:text="#{worktime.list.header.resttime}">休憩時間</th>
						<th th:text="#{worktime.list.header.remarks}">備考</th>
					</tr>
					</thead>
					<tfoot>
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td th:text="${workTimeSum}">180.00</td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td>規定労働時間</td>
						<td>160:00</td>
						<td></td>
					</tr>
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td>残業時間</td>
						<td>20:00</td>
						<td></td>
					</tr>
					</tfoot>
					<tbody>
					<tr th:classappend="${dayTotal}" th:each="workTime : ${workTimeYearMonth.workTimes}" th:with="dayTotal=${#workTimes.workTime(workTime.startAt, workTime.endAt, workTime.restTime)}">
						<td th:text="${#temporals.format(workTime.date, 'MM/dd(E)')}">6/1（木）</td>
						<td th:text="#{|worktime.worktype.${workTime.workType}|}">出勤</td>
						<td th:text="${workTime.startAt}">9:00</td>
						<td th:text="${workTime.endAt}">18:00</td>
						<td th:text="${workTime.restTime}">1:00</td>
						<td th:text="${dayTotal}">8.00</td>
						<td th:text="${workTime.remarks}"></td>
					</tr>
					<!--<tr class="bg-danger">-->
					<!--<td>6/2（金）</td>-->
					<!--<td>出勤</td>-->
					<!--<td>9:00</td>-->
					<!--<td>19:00</td>-->
					<!--<td>1:00</td>-->
					<!--<td>9:00</td>-->
					<!--<td></td>-->
					<!--</tr>-->
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="modal-approve" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true" data-show="true" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content" id="modal-complete">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">承認</h4>
			</div>
			<div class="modal-footer">
				<a class="btn btn-default" data-dismiss="modal">キャンセル</a>
				<button @click="approve" class="btn btn-primary">承認</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="modal-modify" tabindex="-1" role="dialog" aria-labelledby="staticModalLabel" aria-hidden="true" data-show="true" data-keyboard="false" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content" id="modal-complete">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title">修正依頼</h4>
			</div>
			<div class="modal-footer">
				<a class="btn btn-default" data-dismiss="modal">キャンセル</a>
				<button @click="modify" class="btn btn-primary">修正依頼</button>
			</div>
		</div>
	</div>
</div>
<script>
	new Vue({
		el:'#modal-approve',
		methods: {
			approve() {
				const id = '[[${workTimeYearMonth.id}]]';

				axios.post('/work-time/approve/' + id + '?approve1=true')
					.then(response => {
					console.log(response.data);
				// TODO:Vue.jsでバインドする
				location.reload();
			}).catch(error => {
					console.log(error);
			})
			}
		}
	});
	new Vue({
		el:'#modal-modify',
		methods: {
			modify() {
				const id = '[[${workTimeYearMonth.id}]]';

				axios.post('/work-time/approve/' + id + '?approve1=false')
					.then(response => {
					console.log(response.data);
				// TODO:Vue.jsでバインドする
				location.reload();
			}).catch(error => {
					console.log(error);
			})
			}
		}
	});
</script>
</body>
</html>
